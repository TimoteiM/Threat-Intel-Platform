[config] Loaded .env from: C:\Users\tmoscaliuc\Downloads\script\threat-investigator\threat-intel\backend\.env
[config] Settings loaded — VT key: SET
2026-02-28 20:10:34,718 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-28 20:10:34,726 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-28 20:10:34,734 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-28 20:10:34,737 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-28 20:10:34,743 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-28 20:10:34,746 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-28 20:10:34,752 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-28 20:10:34,765 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,767 INFO sqlalchemy.engine.Engine [generated in 0.00288s] ('batches', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,783 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,785 INFO sqlalchemy.engine.Engine [cached since 0.02066s ago] ('investigations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,787 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,788 INFO sqlalchemy.engine.Engine [cached since 0.024s ago] ('collector_results', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,791 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,793 INFO sqlalchemy.engine.Engine [cached since 0.02851s ago] ('evidence', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,796 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,797 INFO sqlalchemy.engine.Engine [cached since 0.033s ago] ('reports', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,800 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,802 INFO sqlalchemy.engine.Engine [cached since 0.03763s ago] ('artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,804 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,805 INFO sqlalchemy.engine.Engine [cached since 0.04134s ago] ('iocs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,807 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,809 INFO sqlalchemy.engine.Engine [cached since 0.04464s ago] ('watchlist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,811 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,813 INFO sqlalchemy.engine.Engine [cached since 0.04817s ago] ('watchlist_alerts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,815 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,816 INFO sqlalchemy.engine.Engine [cached since 0.05182s ago] ('clients', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,819 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,820 INFO sqlalchemy.engine.Engine [cached since 0.05549s ago] ('client_alerts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,823 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,823 INFO sqlalchemy.engine.Engine [cached since 0.05921s ago] ('whois_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,825 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,827 INFO sqlalchemy.engine.Engine [cached since 0.06271s ago] ('ip_lookups', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,830 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,832 INFO sqlalchemy.engine.Engine [cached since 0.06808s ago] ('lookup_cache', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,835 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 20:10:34,836 INFO sqlalchemy.engine.Engine [cached since 0.07165s ago] ('email_investigation_runs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 20:10:34,839 INFO sqlalchemy.engine.Engine ALTER TABLE clients ADD COLUMN IF NOT EXISTS default_collectors JSONB NOT NULL DEFAULT '[]'::jsonb
2026-02-28 20:10:34,841 INFO sqlalchemy.engine.Engine [generated in 0.00254s] ()
2026-02-28 20:10:34,848 INFO sqlalchemy.engine.Engine ALTER TABLE investigations ADD COLUMN IF NOT EXISTS observable_type VARCHAR(20) NOT NULL DEFAULT 'domain'
2026-02-28 20:10:34,851 INFO sqlalchemy.engine.Engine [generated in 0.00291s] ()
2026-02-28 20:10:34,854 INFO sqlalchemy.engine.Engine ALTER TABLE investigations ALTER COLUMN domain TYPE VARCHAR(512)
2026-02-28 20:10:34,855 INFO sqlalchemy.engine.Engine [generated in 0.00132s] ()
2026-02-28 20:10:34,863 INFO sqlalchemy.engine.Engine COMMIT
2026-02-28 20:10:35,245 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-28 20:10:35,306 INFO sqlalchemy.engine.Engine SELECT investigations.id, investigations.domain, investigations.observable_type, investigations.state, investigations.context, investigations.client_domain, investigations.batch_id, investigations.created_at, investigations.updated_at, investigations.concluded_at, investigations.classification, investigations.confidence, investigations.risk_score, investigations.recommended_action, investigations.analyst_iterations, investigations.max_analyst_iterations 
FROM investigations ORDER BY investigations.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-28 20:10:35,308 INFO sqlalchemy.engine.Engine [generated in 0.00279s] (1, 0)
2026-02-28 20:10:35,324 INFO sqlalchemy.engine.Engine SELECT count(investigations.id) AS count_1 
FROM investigations
2026-02-28 20:10:35,329 INFO sqlalchemy.engine.Engine [generated in 0.00471s] ()
INFO:     127.0.0.1:51923 - "GET /api/investigations?limit=1&offset=0 HTTP/1.1" 200 OK
2026-02-28 20:10:35,336 INFO sqlalchemy.engine.Engine COMMIT
2026-02-28 20:10:46,220 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-28 20:10:46,225 INFO sqlalchemy.engine.Engine SELECT email_investigation_runs.id, email_investigation_runs.filename, email_investigation_runs.email_subject, email_investigation_runs.sender_email, email_investigation_runs.sender_domain, email_investigation_runs.sender_ip, email_investigation_runs.resolution_source, email_investigation_runs.result_json, email_investigation_runs.created_at 
FROM email_investigation_runs ORDER BY email_investigation_runs.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-28 20:10:46,227 INFO sqlalchemy.engine.Engine [generated in 0.00195s] (20, 0)
INFO:     127.0.0.1:54118 - "GET /api/email-investigations/history?limit=20&offset=0 HTTP/1.1" 200 OK
2026-02-28 20:10:46,242 INFO sqlalchemy.engine.Engine COMMIT
2026-02-28 20:10:46,272 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-28 20:10:46,276 INFO sqlalchemy.engine.Engine SELECT email_investigation_runs.id, email_investigation_runs.filename, email_investigation_runs.email_subject, email_investigation_runs.sender_email, email_investigation_runs.sender_domain, email_investigation_runs.sender_ip, email_investigation_runs.resolution_source, email_investigation_runs.result_json, email_investigation_runs.created_at 
FROM email_investigation_runs ORDER BY email_investigation_runs.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-28 20:10:46,279 INFO sqlalchemy.engine.Engine [cached since 0.05403s ago] (20, 0)
INFO:     127.0.0.1:54119 - "GET /api/email-investigations/history?limit=20&offset=0 HTTP/1.1" 200 OK
2026-02-28 20:10:46,287 INFO sqlalchemy.engine.Engine COMMIT
2026-02-28 20:12:12,861 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-28 20:12:12,867 INFO sqlalchemy.engine.Engine INSERT INTO email_investigation_runs (id, filename, email_subject, sender_email, sender_domain, sender_ip, resolution_source, result_json) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::JSONB) RETURNING email_investigation_runs.created_at
2026-02-28 20:12:12,868 INFO sqlalchemy.engine.Engine [generated in 0.00113s] (UUID('f2a4ce43-11ce-46b3-b5a3-0458b6e6fe80'), '15f5c2ce-70bf-f7ba-5944-00f638bda152.eml', 'J2 Marketing Day at UKREiiF - Day Pass & Access', 'noreply@j2.net', 'j2.net', '203.55.21.50', 'ai', '{"filename": "15f5c2ce-70bf-f7ba-5944-00f638bda152.eml", "email_subject": "J2 Marketing Day at UKREiiF - Day Pass & Access", "sender_email": "noreply ... (7801 characters truncated) ... cmail20.com and DKIM includes a signature from cmail2.com; the sender IP 203.55.21.50 is associated with CAMPAIGN MONITOR (a mailing provider)."}]}}}')
2026-02-28 20:12:12,871 INFO sqlalchemy.engine.Engine COMMIT
2026-02-28 20:12:12,873 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-28 20:12:12,875 INFO sqlalchemy.engine.Engine SELECT email_investigation_runs.id, email_investigation_runs.filename, email_investigation_runs.email_subject, email_investigation_runs.sender_email, email_investigation_runs.sender_domain, email_investigation_runs.sender_ip, email_investigation_runs.resolution_source, email_investigation_runs.result_json, email_investigation_runs.created_at 
FROM email_investigation_runs 
WHERE email_investigation_runs.id = $1::UUID
2026-02-28 20:12:12,876 INFO sqlalchemy.engine.Engine [generated in 0.00074s] (UUID('f2a4ce43-11ce-46b3-b5a3-0458b6e6fe80'),)
INFO:     127.0.0.1:60893 - "POST /api/email-investigations/upload HTTP/1.1" 200 OK
2026-02-28 20:12:12,887 INFO sqlalchemy.engine.Engine COMMIT
2026-02-28 20:12:12,913 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-28 20:12:12,915 INFO sqlalchemy.engine.Engine SELECT email_investigation_runs.id, email_investigation_runs.filename, email_investigation_runs.email_subject, email_investigation_runs.sender_email, email_investigation_runs.sender_domain, email_investigation_runs.sender_ip, email_investigation_runs.resolution_source, email_investigation_runs.result_json, email_investigation_runs.created_at 
FROM email_investigation_runs ORDER BY email_investigation_runs.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-28 20:12:12,917 INFO sqlalchemy.engine.Engine [cached since 86.69s ago] (20, 0)
INFO:     127.0.0.1:51079 - "GET /api/email-investigations/history?limit=20&offset=0 HTTP/1.1" 200 OK
2026-02-28 20:12:12,923 INFO sqlalchemy.engine.Engine COMMIT
