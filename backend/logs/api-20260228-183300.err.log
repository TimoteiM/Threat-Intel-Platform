INFO:     Started server process [129004]
INFO:     Waiting for application startup.
2026-02-28 18:33:16,610 INFO     [sqlalchemy.engine.Engine] select pg_catalog.version()
2026-02-28 18:33:16,615 INFO     [sqlalchemy.engine.Engine] [raw sql] ()
2026-02-28 18:33:16,619 INFO     [sqlalchemy.engine.Engine] select current_schema()
2026-02-28 18:33:16,623 INFO     [sqlalchemy.engine.Engine] [raw sql] ()
2026-02-28 18:33:16,628 INFO     [sqlalchemy.engine.Engine] show standard_conforming_strings
2026-02-28 18:33:16,630 INFO     [sqlalchemy.engine.Engine] [raw sql] ()
2026-02-28 18:33:16,635 INFO     [sqlalchemy.engine.Engine] BEGIN (implicit)
2026-02-28 18:33:16,642 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,643 INFO     [sqlalchemy.engine.Engine] [generated in 0.00122s] ('batches', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,649 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,650 INFO     [sqlalchemy.engine.Engine] [cached since 0.008056s ago] ('investigations', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,652 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,652 INFO     [sqlalchemy.engine.Engine] [cached since 0.01061s ago] ('collector_results', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,654 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,655 INFO     [sqlalchemy.engine.Engine] [cached since 0.01313s ago] ('evidence', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,656 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,657 INFO     [sqlalchemy.engine.Engine] [cached since 0.01563s ago] ('reports', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,659 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,661 INFO     [sqlalchemy.engine.Engine] [cached since 0.01898s ago] ('artifacts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,663 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,664 INFO     [sqlalchemy.engine.Engine] [cached since 0.02176s ago] ('iocs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,665 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,666 INFO     [sqlalchemy.engine.Engine] [cached since 0.02451s ago] ('watchlist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,668 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,669 INFO     [sqlalchemy.engine.Engine] [cached since 0.02729s ago] ('watchlist_alerts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,670 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,671 INFO     [sqlalchemy.engine.Engine] [cached since 0.02932s ago] ('clients', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,673 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,674 INFO     [sqlalchemy.engine.Engine] [cached since 0.03245s ago] ('client_alerts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,676 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,677 INFO     [sqlalchemy.engine.Engine] [cached since 0.03483s ago] ('whois_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,679 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,680 INFO     [sqlalchemy.engine.Engine] [cached since 0.03826s ago] ('ip_lookups', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,682 INFO     [sqlalchemy.engine.Engine] SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-28 18:33:16,683 INFO     [sqlalchemy.engine.Engine] [cached since 0.04112s ago] ('lookup_cache', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-28 18:33:16,685 INFO     [sqlalchemy.engine.Engine] ALTER TABLE clients ADD COLUMN IF NOT EXISTS default_collectors JSONB NOT NULL DEFAULT '[]'::jsonb
2026-02-28 18:33:16,687 INFO     [sqlalchemy.engine.Engine] [generated in 0.00134s] ()
2026-02-28 18:33:16,691 INFO     [sqlalchemy.engine.Engine] ALTER TABLE investigations ADD COLUMN IF NOT EXISTS observable_type VARCHAR(20) NOT NULL DEFAULT 'domain'
2026-02-28 18:33:16,692 INFO     [sqlalchemy.engine.Engine] [generated in 0.00127s] ()
2026-02-28 18:33:16,695 INFO     [sqlalchemy.engine.Engine] ALTER TABLE investigations ALTER COLUMN domain TYPE VARCHAR(512)
2026-02-28 18:33:16,695 INFO     [sqlalchemy.engine.Engine] [generated in 0.00108s] ()
2026-02-28 18:33:16,703 INFO     [sqlalchemy.engine.Engine] COMMIT
2026-02-28 18:33:16,705 INFO     [app.main] Database schema verified / migrated
2026-02-28 18:33:16,706 INFO     [app.main] Threat Investigation Platform starting
2026-02-28 18:33:16,706 INFO     [app.main] Environment: development
2026-02-28 18:33:16,706 INFO     [app.main] Analyst model: gpt-5-mini
2026-02-28 18:33:16,706 INFO     [app.main] Claude fallback: enabled (model=claude-sonnet-4-20250514)
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8010 (Press CTRL+C to quit)
2026-02-28 18:33:16,954 INFO     [sqlalchemy.engine.Engine] BEGIN (implicit)
2026-02-28 18:33:16,985 INFO     [sqlalchemy.engine.Engine] SELECT investigations.id, investigations.domain, investigations.observable_type, investigations.state, investigations.context, investigations.client_domain, investigations.batch_id, investigations.created_at, investigations.updated_at, investigations.concluded_at, investigations.classification, investigations.confidence, investigations.risk_score, investigations.recommended_action, investigations.analyst_iterations, investigations.max_analyst_iterations 
FROM investigations ORDER BY investigations.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-28 18:33:16,987 INFO     [sqlalchemy.engine.Engine] [generated in 0.00218s] (1, 0)
2026-02-28 18:33:16,996 INFO     [sqlalchemy.engine.Engine] SELECT count(investigations.id) AS count_1 
FROM investigations
2026-02-28 18:33:16,998 INFO     [sqlalchemy.engine.Engine] [generated in 0.00122s] ()
2026-02-28 18:33:17,002 INFO     [sqlalchemy.engine.Engine] COMMIT
2026-02-28 18:38:36,495 INFO     [httpx] HTTP Request: POST https://api.openai.com/v1/responses "HTTP/1.1 400 Bad Request"
2026-02-28 18:38:36,497 WARNING  [app.services.email_ai_interpreter_service] OpenAI email interpretation failed (BadRequestError: Error code: 400 - {'error': {'message': 'Your input exceeds the context window of this model. Please adjust your input and try again.', 'type': 'invalid_request_error', 'param': 'input', 'code': 'context_length_exceeded'}}). Falling back to Claude.
2026-02-28 18:38:37,606 INFO     [httpx] HTTP Request: POST https://api.anthropic.com/v1/messages "HTTP/1.1 400 Bad Request"
2026-02-28 18:46:52,903 INFO     [httpx] HTTP Request: POST https://api.openai.com/v1/responses "HTTP/1.1 200 OK"
