[config] Loaded .env from: C:\Users\tmoscaliuc\Downloads\script\threat-investigator\threat-intel\backend\.env
[config] Settings loaded — VT key: SET
 
 -------------- celery-local-8000-20260227-234153@EXP-JFW2P34 v5.6.2 (recovery)
--- ***** ----- 
-- ******* ---- Windows-11-10.0.26200-SP0 2026-02-27 23:41:57
- *** --- * --- 
- ** ---------- [config]
- ** ---------- .> app:         threat_intel:0x18159238ce0
- ** ---------- .> transport:   redis://127.0.0.1:6379/5
- ** ---------- .> results:     redis://127.0.0.1:6379/6
- *** --- * --- .> concurrency: 8 (thread)
-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)
--- ***** ----- 
 -------------- [queues]
                .> investigations   exchange=investigations(direct) key=investigations
                

[tasks]
  . tasks.process_batch
  . tasks.run_analysis
  . tasks.run_collector
  . tasks.run_investigation
  . tasks.watchlist_check

2026-02-27 23:47:24,944 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-27 23:47:24,945 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-02-27 23:47:24,948 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-27 23:47:24,950 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-02-27 23:47:24,952 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-27 23:47:24,953 INFO sqlalchemy.engine.Engine [raw sql] {}
2026-02-27 23:47:24,955 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:47:25,007 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:47:25,008 INFO sqlalchemy.engine.Engine [generated in 0.00176s] {'pk_1': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:25,013 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-27 23:47:25,018 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:47:25,020 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:47:25,020 INFO sqlalchemy.engine.Engine [cached since 0.01428s ago] {'pk_1': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:25,025 INFO sqlalchemy.engine.Engine UPDATE investigations SET state=%(state)s, updated_at=%(updated_at)s WHERE investigations.id = %(investigations_id)s::UUID
2026-02-27 23:47:25,027 INFO sqlalchemy.engine.Engine [generated in 0.00146s] {'state': 'gathering', 'updated_at': datetime.datetime(2026, 2, 27, 21, 47, 25, 23681, tzinfo=datetime.timezone.utc), 'investigations_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:25,032 INFO sqlalchemy.engine.Engine COMMIT
2026-02-27 23:47:26,534 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:47:26,535 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:47:26,536 INFO sqlalchemy.engine.Engine [cached since 1.529s ago] {'pk_1': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:26,537 INFO sqlalchemy.engine.Engine UPDATE investigations SET state=%(state)s, updated_at=%(updated_at)s WHERE investigations.id = %(investigations_id)s::UUID
2026-02-27 23:47:26,538 INFO sqlalchemy.engine.Engine [cached since 1.513s ago] {'state': 'evaluating', 'updated_at': datetime.datetime(2026, 2, 27, 21, 47, 26, 537325, tzinfo=datetime.timezone.utc), 'investigations_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:26,540 INFO sqlalchemy.engine.Engine COMMIT
2026-02-27 23:47:26,551 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:47:26,552 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:47:26,553 INFO sqlalchemy.engine.Engine [cached since 1.547s ago] {'pk_1': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:26,556 INFO sqlalchemy.engine.Engine UPDATE investigations SET state=%(state)s, updated_at=now(), concluded_at=%(concluded_at)s, classification=%(classification)s, confidence=%(confidence)s, risk_score=%(risk_score)s, recommended_action=%(recommended_action)s WHERE investigations.id = %(investigations_id)s::UUID
2026-02-27 23:47:26,557 INFO sqlalchemy.engine.Engine [generated in 0.00129s] {'state': 'concluded', 'concluded_at': datetime.datetime(2026, 2, 27, 21, 47, 26, 555589, tzinfo=datetime.timezone.utc), 'classification': 'malicious', 'confidence': 'high', 'risk_score': 98, 'recommended_action': 'block', 'investigations_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:26,562 INFO sqlalchemy.engine.Engine INSERT INTO evidence (id, investigation_id, evidence_json, signals, data_gaps, external_context) VALUES (%(id)s::UUID, %(investigation_id)s::UUID, %(evidence_json)s::JSONB, %(signals)s::JSONB, %(data_gaps)s::JSONB, %(external_context)s::JSONB) RETURNING evidence.created_at
2026-02-27 23:47:26,563 INFO sqlalchemy.engine.Engine [generated in 0.00115s] {'id': UUID('fe95ed23-b1dd-4837-979f-222fccc3437d'), 'investigation_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143'), 'evidence_json': '{"domain": "44d88612fea8a8f36de82e1278abb02f", "observable_type": "hash", "investigation_id": "838a125d-bd37-4a27-916d-fcc2bbb90143", "target_domain" ... (11600 characters truncated) ... c, Elastic, MicroWorld-eScan, ClamAV...)", "severity": "high", "evidence_refs": ["vt.malicious_count", "vt.flagged_malicious_by"]}], "data_gaps": []}', 'signals': '[{"id": "sig_no_dmarc", "category": "email_security", "description": "No DMARC record \\u2014 domain can be spoofed in email", "severity": "low", "ev ... (307 characters truncated) ... cious (Bkav, Lionic, Elastic, MicroWorld-eScan, ClamAV...)", "severity": "high", "evidence_refs": ["vt.malicious_count", "vt.flagged_malicious_by"]}]', 'data_gaps': '[]', 'external_context': 'null'}
2026-02-27 23:47:26,569 INFO sqlalchemy.engine.Engine INSERT INTO reports (id, investigation_id, iteration, report_json, executive_summary, technical_narrative, recommendations) VALUES (%(id)s::UUID, %(investigation_id)s::UUID, %(iteration)s, %(report_json)s::JSONB, %(executive_summary)s, %(technical_narrative)s, %(recommendations)s) RETURNING reports.created_at
2026-02-27 23:47:26,569 INFO sqlalchemy.engine.Engine [generated in 0.00100s] {'id': UUID('b7710850-23fa-484e-8fe4-a21e1e1a59d0'), 'investigation_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143'), 'iteration': 0, 'report_json': '{"classification": "malicious", "confidence": "high", "investigation_state": "concluded", "primary_reasoning": "Automated analysis for HASH  -  44d88 ... (1749 characters truncated) ... ne and remove the file from all systems Investigate execution history and lateral movement Check EDR telemetry for related processes or persistence"}', 'executive_summary': 'Automated analysis for HASH  -  44d88612fea8a8f36de82e1278abb02f. Classification: MALICIOUS (high confidence). Risk score: 98/100. Key evidence: Detected malicious by 67/76 antivirus vendors; Flagged by: Bkav, Lionic, Elastic, MicroWorld-eScan, ClamAV +62 more', 'technical_narrative': 'Automated analysis for HASH  -  44d88612fea8a8f36de82e1278abb02f. Classification: MALICIOUS (high confidence). Risk score: 98/100. Key evidence: Detected malicious by 67/76 antivirus vendors; Flagged by: Bkav, Lionic, Elastic, MicroWorld-eScan, ClamAV +62 more', 'recommendations': 'Recommended action: block. Quarantine and remove the file from all systems Investigate execution history and lateral movement Check EDR telemetry for related processes or persistence'}
2026-02-27 23:47:26,575 INFO sqlalchemy.engine.Engine INSERT INTO collector_results (id, investigation_id, collector_name, status, version, started_at, completed_at, duration_ms, evidence_json, error, raw_artifact_hash) VALUES (%(id)s::UUID, %(investigation_id)s::UUID, %(collector_name)s, %(status)s, %(version)s, %(started_at)s, %(completed_at)s, %(duration_ms)s, %(evidence_json)s::JSONB, %(error)s, %(raw_artifact_hash)s)
2026-02-27 23:47:26,576 INFO sqlalchemy.engine.Engine [generated in 0.00097s] {'id': UUID('27761851-cedb-4238-bbdb-3437ffc9e218'), 'investigation_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143'), 'collector_name': 'threat_feeds', 'status': 'completed', 'version': '1.0.0', 'started_at': None, 'completed_at': None, 'duration_ms': 906, 'evidence_json': '{"meta": {"collector": "threat_feeds", "version": "1.0.0", "status": "completed", "started_at": "2026-02-27T21:47:25.042771Z", "completed_at": "2026- ... (217 characters truncated) ... "abuseipdb (not applicable for hash)", "phishtank (not applicable for hash)", "openphish (not applicable for hash)", "threatfox (error: HTTPError)"]}', 'error': None, 'raw_artifact_hash': None}
2026-02-27 23:47:26,578 INFO sqlalchemy.engine.Engine INSERT INTO collector_results (id, investigation_id, collector_name, status, version, started_at, completed_at, duration_ms, evidence_json, error, raw_artifact_hash) VALUES (%(id)s::UUID, %(investigation_id)s::UUID, %(collector_name)s, %(status)s, %(version)s, %(started_at)s, %(completed_at)s, %(duration_ms)s, %(evidence_json)s::JSONB, %(error)s, %(raw_artifact_hash)s)
2026-02-27 23:47:26,579 INFO sqlalchemy.engine.Engine [cached since 0.00535s ago] {'id': UUID('be076dd7-43f5-4747-853a-64ae0d32bfd5'), 'investigation_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143'), 'collector_name': 'vt', 'status': 'completed', 'version': '1.0.0', 'started_at': None, 'completed_at': None, 'duration_ms': 1483, 'evidence_json': '{"meta": {"collector": "vt", "version": "1.0.0", "status": "completed", "started_at": "2026-02-27T21:47:25.041015Z", "completed_at": "2026-02-27T21:4 ... (9976 characters truncated) ... .com", "eicar.com-9979", "eicar.com-5181", "eicar.com-559", "eicar.txt", "eicar.com-44957", "eicar.com-36281", "eicar.com-27577", "eicar.com-22339"]}', 'error': None, 'raw_artifact_hash': None}
2026-02-27 23:47:26,583 INFO sqlalchemy.engine.Engine INSERT INTO iocs (id, investigation_id, type, value, context, confidence) VALUES (%(id)s::UUID, %(investigation_id)s::UUID, %(type)s, %(value)s, %(context)s, %(confidence)s) RETURNING iocs.created_at
2026-02-27 23:47:26,584 INFO sqlalchemy.engine.Engine [generated in 0.00081s] {'id': UUID('9edd90b1-bef3-41d1-a104-ed151d906bf8'), 'investigation_id': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143'), 'type': 'hash', 'value': '44d88612fea8a8f36de82e1278abb02f', 'context': 'Investigated sample/hash', 'confidence': 'high'}
2026-02-27 23:47:26,588 INFO sqlalchemy.engine.Engine COMMIT
2026-02-27 23:47:26,591 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:47:26,593 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:47:26,593 INFO sqlalchemy.engine.Engine [generated in 0.00073s] {'pk_1': UUID('838a125d-bd37-4a27-916d-fcc2bbb90143')}
2026-02-27 23:47:26,597 INFO sqlalchemy.engine.Engine SELECT clients.id, clients.name, clients.domain, clients.aliases, clients.brand_keywords, clients.contact_email, clients.notes, clients.status, clients.created_at, clients.alert_count, clients.last_alert_at, clients.default_collectors 
FROM clients 
WHERE clients.status = %(status_1)s
2026-02-27 23:47:26,597 INFO sqlalchemy.engine.Engine [generated in 0.00077s] {'status_1': 'active'}
2026-02-27 23:47:26,600 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-27 23:48:01,801 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:48:01,803 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:48:01,804 INFO sqlalchemy.engine.Engine [cached since 36.8s ago] {'pk_1': UUID('2da593cd-d093-4703-a223-892a6f609ebd')}
2026-02-27 23:48:01,807 INFO sqlalchemy.engine.Engine ROLLBACK
2026-02-27 23:48:01,809 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:48:01,810 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:48:01,811 INFO sqlalchemy.engine.Engine [cached since 36.8s ago] {'pk_1': UUID('2da593cd-d093-4703-a223-892a6f609ebd')}
2026-02-27 23:48:01,813 INFO sqlalchemy.engine.Engine UPDATE investigations SET state=%(state)s, updated_at=%(updated_at)s WHERE investigations.id = %(investigations_id)s::UUID
2026-02-27 23:48:01,814 INFO sqlalchemy.engine.Engine [cached since 36.79s ago] {'state': 'gathering', 'updated_at': datetime.datetime(2026, 2, 27, 21, 48, 1, 813604, tzinfo=datetime.timezone.utc), 'investigations_id': UUID('2da593cd-d093-4703-a223-892a6f609ebd')}
2026-02-27 23:48:01,816 INFO sqlalchemy.engine.Engine COMMIT
2026-02-27 23:48:28,546 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-27 23:48:28,547 INFO sqlalchemy.engine.Engine SELECT investigations.id AS investigations_id, investigations.domain AS investigations_domain, investigations.observable_type AS investigations_observable_type, investigations.state AS investigations_state, investigations.context AS investigations_context, investigations.client_domain AS investigations_client_domain, investigations.batch_id AS investigations_batch_id, investigations.created_at AS investigations_created_at, investigations.updated_at AS investigations_updated_at, investigations.concluded_at AS investigations_concluded_at, investigations.classification AS investigations_classification, investigations.confidence AS investigations_confidence, investigations.risk_score AS investigations_risk_score, investigations.recommended_action AS investigations_recommended_action, investigations.analyst_iterations AS investigations_analyst_iterations, investigations.max_analyst_iterations AS investigations_max_analyst_iterations 
FROM investigations 
WHERE investigations.id = %(pk_1)s::UUID
2026-02-27 23:48:28,549 INFO sqlalchemy.engine.Engine [cached since 63.54s ago] {'pk_1': UUID('2da593cd-d093-4703-a223-892a6f609ebd')}
2026-02-27 23:48:28,555 INFO sqlalchemy.engine.Engine UPDATE investigations SET state=%(state)s, updated_at=%(updated_at)s WHERE investigations.id = %(investigations_id)s::UUID
2026-02-27 23:48:28,558 INFO sqlalchemy.engine.Engine [cached since 63.53s ago] {'state': 'evaluating', 'updated_at': datetime.datetime(2026, 2, 27, 21, 48, 28, 554220, tzinfo=datetime.timezone.utc), 'investigations_id': UUID('2da593cd-d093-4703-a223-892a6f609ebd')}
2026-02-27 23:48:28,562 INFO sqlalchemy.engine.Engine COMMIT
